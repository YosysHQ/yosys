CMAKE_MINIMUM_REQUIRED(VERSION 3.10.3)
PROJECT(yosys)

SET(CMAKE_C_STANDARD 11)
SET(CMAKE_CXX_STANDARD 11)
FIND_PACKAGE(FLEX)
FIND_PACKAGE(BISON)

OPTION(ENABLE_ABC "Enable use ABC library." ON)

ADD_DEFINITIONS(-D_YOSYS_)
ADD_DEFINITIONS(-DYOSYS_ENABLE_READLINE)
ADD_DEFINITIONS(-DYOSYS_ENABLE_PLUGINS)
ADD_DEFINITIONS(-DYOSYS_ENABLE_GLOB)
ADD_DEFINITIONS(-DYOSYS_ENABLE_TCL)
ADD_DEFINITIONS(-DYOSYS_ENABLE_COVER)
ADD_DEFINITIONS(-DYOSYS_ENABLE_ZLIB)
ADD_DEFINITIONS(-DYOSYS_SRC="${CMAKE_CURRENT_LIST_DIR}/")
ADD_DEFINITIONS(-DYOSYS_DATDIR="/usr/local/share/yosys")

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_LIST_DIR})
INCLUDE_DIRECTORIES(/usr/include/tcl8.6)
ADD_COMPILE_OPTIONS(-Wall -Wextra -ggdb -Os -g -I/usr/include/tcl -MD -fPIC)
ADD_COMPILE_OPTIONS(-Wno-unused-parameter)

IF (${ENABLE_ABC})
    ADD_DEFINITIONS(-DYOSYS_ENABLE_ABC)
    ADD_SUBDIRECTORY(abc)
ENDIF()

ADD_SUBDIRECTORY(kernel)
ADD_SUBDIRECTORY(frontends)
ADD_SUBDIRECTORY(passes)
ADD_SUBDIRECTORY(backends)
ADD_SUBDIRECTORY(techlibs)
ADD_SUBDIRECTORY(libs)

SET(SRC_LIST
        ${KERNEL_SRC}
        ${FRONTENDS_SRC}
        ${PASSES_SRC}
        ${BACKENDS_SRC}
        ${TECHLIBS_SRC}
        ${LIBS_SRC}
        )

ADD_EXECUTABLE(${PROJECT_NAME} ${SRC_LIST})

IF (${ENABLE_ABC})
    TARGET_LINK_LIBRARIES(${PROJECT_NAME} libabc)
ENDIF()

TARGET_LINK_LIBRARIES(${PROJECT_NAME} -lstdc++ -lm -lz -lrt -lreadline -lffi -ldl -ltcl8.6)
